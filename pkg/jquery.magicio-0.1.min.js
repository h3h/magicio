/*!
* Magicio 0.1
*
* Copyright 2013, Brad Fults - http://bradfults.com/
* Released under the MIT License
* https://github.com/h3h/magicio/LICENSE
*
* Thanks to Dave Rupert for inspiration from Lettering.js
* https://github.com/davatron5000/Lettering.js
*/

(function(){var e=[].slice;(function(t){var n,r,i,s,o,u;u={};r="eefec303079ad17405c889e092e105b0";s=function(){var t,n;t=arguments[0],n=2<=arguments.length?e.call(arguments,1):[];if(u.debug){if(n.length){return typeof console!=="undefined"&&console!==null?console.log(t,n):void 0}else{return typeof console!=="undefined"&&console!==null?console.log(t):void 0}}};i=function(e){if(/\bm-break-parsed\b/.test(e.className)){return"break"}else{return"pause"}};n=function(){function e(e,t,n,r,i){this.nextElement=e;this.prevElement=t;this.actionClasses=n;this.actionType=r;this.timing=i}e.prototype.eventType=function(){var e;try{return this.actionClasses.match(/\bm-action-(input|timeout)\b/)[1]}catch(t){e=t;switch(this.actionType){case"pause":return u.actionOnPause;case"break":return u.actionOnBreak}}};return e}();o={init:function(e){u={debug:false,actionOnPause:"timeout",actionOnBreak:"input",pauseMilliseconds:1e3};u=t.extend(u,e);return this.each(function(){var e;s('Initializing Magicio for element with id "'+this.id+'"');e=t(this);o.parse(e);return o.buildActions(e)})},destroy:function(e){return this.each(function(){s('Destroying Magicio for element with id "'+this.id+'"');return t(this).removeData("magicio")})},buildActions:function(e){var r,o;o=e.data("magicio").actors;e.removeData("magicio","actors");r=t.map(o,function(e,r){var s,a,f,l,c,h,p;if(r>0){c=function(){try{return i(o[r-1])}catch(e){f=e;return null}}();a=i(e);s=e.className.replace(/m-(pause|break)(-parsed)?/g,"");l=e;h=function(){if(a==="break"){try{return t(e).prev(".m-break-parsed")[0]}catch(n){f=n;return null}}else{if(c==="pause"){return o[r-1]}}}();p=function(){try{return parseInt(e.className.match(/\bm-timing-(\d+)\b/)[1],10)}catch(t){f=t;return u.pauseMilliseconds}}();return new n(l,h,s,a,p)}});s("Actions: %o",r);return e.data("magicio",{actions:r})},parse:function(e){var n,i;e.trigger("beforeparse");i=e.children(".m-break");s("Breaks: "+i.length);if(i.length===0){i=e}else{i.addClass("m-break-parsed")}i.each(function(){var e,n,i;e=t(this);i=e.children("br.m-pause");s("Pauses: "+i.length);i.replaceWith(r);n=e.html().split(r);if(n.length>0){n=t.map(n,function(e,t){var n;n=i[t-1]?i[t-1].className.replace(/\bm-pause\b/,""):"";return"<span class='m-pause-parsed "+n+"'>"+e+"</span>"});return e.html(n.join(""))}});n=e.find(".m-break-parsed, span.m-pause-parsed");s("Actors: %o",n);e.data("magicio",{actors:n});return e.trigger(t.Event("afterparse",{actors:n}))},run:function(){return this.each(function(){var e,n,r,i;s("Magicio running on element with data: %o",t(this).data("magicio"));i=t(this);n=i.data("magicio");e=n.actions;i.trigger(t.Event("beforerun",{actions:e}));r=n.current_action_index||0;return o.runAction(i,e,r)})},runAction:function(e,n,r){var i,u,a,f;i=n[r];f=n[r-1];if(f){e.trigger(t.Event("after"+f.actionType,{action:f}))}if(!i){s("Ran out of actions.");e.trigger(t.Event("afterrun",{actions:n}));return true}s("Going to execute action %o",i);e.trigger(t.Event("before"+i.actionType,{action:i}));s("eventType: "+i.eventType());s("timing: "+i.timing);a=r+1;switch(i.eventType()){case"timeout":setTimeout(function(){return o.runAction(e,n,a)},i.timing);break;case"input":u=function(){t(document).off("click",u);t(document).off("keypress",u);return o.runAction(e,n,a)};t(document).on("click",u);t(document).on("keypress",u)}return e.data("magicio",{current_action_index:a})}};return t.fn.extend({magicio:function(e){if(o[e]){return o[e].apply(this,Array.prototype.slice.call(arguments,1))}else{return o.init.apply(this,arguments)}}})})(jQuery)}).call(this)
